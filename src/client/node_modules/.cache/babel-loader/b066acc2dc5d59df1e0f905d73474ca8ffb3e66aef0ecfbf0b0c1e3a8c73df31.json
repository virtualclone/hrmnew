{"ast":null,"code":"import { required, validDateFormat, endDateShouldBeAfterStartDate, maxCurrency, digitsOnlyWithDecimalPoint } from '@ohrm/core/util/validation/rules';\nimport { yearRange } from '@ohrm/core/util/helper/year-range';\nimport useDateFormat from '@/core/util/composable/useDateFormat';\nconst membershipModel = {\n  membership: [],\n  subscriptionFee: '',\n  subscriptionPaidBy: null,\n  currencyType: [],\n  subscriptionCommenceDate: '',\n  subscriptionRenewalDate: ''\n};\nexport default {\n  name: 'EditMembership',\n  props: {\n    http: {\n      type: Object,\n      required: true\n    },\n    data: {\n      type: Object,\n      required: true\n    },\n    currencies: {\n      type: Array,\n      default: () => []\n    },\n    paidBy: {\n      type: Array,\n      default: () => []\n    },\n    memberships: {\n      type: Array,\n      default: () => []\n    }\n  },\n  emits: ['close'],\n  setup() {\n    const {\n      userDateFormat\n    } = useDateFormat();\n    return {\n      userDateFormat\n    };\n  },\n  data() {\n    return {\n      isLoading: false,\n      membership: {\n        ...membershipModel\n      },\n      yearArray: [...yearRange()],\n      rules: {\n        membership: [required],\n        subscriptionCommenceDate: [validDateFormat(this.userDateFormat)],\n        subscriptionRenewalDate: [validDateFormat(this.userDateFormat), endDateShouldBeAfterStartDate(() => this.membership.subscriptionCommenceDate, this.$t('pim.renewal_date_should_be_after_the_commencing_date'))],\n        subscriptionFee: [digitsOnlyWithDecimalPoint, maxCurrency(1000000000)]\n      }\n    };\n  },\n  beforeMount() {\n    this.isLoading = true;\n    this.http.get(this.data.id).then(response => {\n      const {\n        data\n      } = response.data;\n      this.membership.subscriptionFee = data.subscriptionFee;\n      this.membership.subscriptionCommenceDate = data.subscriptionCommenceDate;\n      this.membership.subscriptionRenewalDate = data.subscriptionRenewalDate;\n      this.membership.membership = this.memberships.find(item => item.id === data.membership.id);\n      this.membership.subscriptionPaidBy = this.paidBy.find(item => item.id === data.subscriptionPaidBy);\n      this.membership.currencyType = this.currencies.find(item => item.id === data.currencyType?.id);\n    }).finally(() => {\n      this.isLoading = false;\n    });\n  },\n  methods: {\n    onSave() {\n      this.isLoading = true;\n      this.http.update(this.data.id, {\n        subscriptionFee: this.membership.subscriptionFee,\n        subscriptionCommenceDate: this.membership.subscriptionCommenceDate,\n        subscriptionRenewalDate: this.membership.subscriptionRenewalDate,\n        membershipId: this.membership.membership.id,\n        subscriptionPaidBy: this.membership.subscriptionPaidBy?.id,\n        currencyTypeId: this.membership.currencyType?.id\n      }).then(() => {\n        return this.$toast.updateSuccess();\n      }).then(() => {\n        this.membership = {\n          ...membershipModel\n        };\n        this.onCancel();\n      });\n    },\n    onCancel() {\n      this.$emit('close', true);\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}